* 画像認識の概要

- セマンティックギャップ(semantic gap)
  - 画像の見た目と意味との乖離のこと
    - よくわからないけど、画像にも文脈があるということかな
- SIFTって1999年だったのか
   - 意外と古い手法だ
- Bag of Visual Wordsが2003年でしばらくそれがデファクトスタンダード
- スパースコンピューティングのなんたるかがわかっていない
   - いや、疎であることはわかるが
- 2012年に深層学習のブーム
   - GPGPU(NVIDIA)の台頭

** 画像認識の分類
- 物体認識とシーン認識
- 物体認識は、インスタンス認識とクラス認識
  - イメージとしては、インスタンスが固有名詞(ゴールデンゲーツブリッジ)でクラス認識が一般名称（橋）など
    - インスタンス認識でが類似画像検索で、クラス認識が特徴の抽象化というか汎化というかそういった分野と強い関わりをもつ
  - 詳細物体認識
    - イメージとしては、クラス認識に近い。犬ではなく柴犬（そもそも言語が多層的なので）
- 画像アノテーション
  - 複数のラベルが付与されたデータ集合を用いて、入力画像に複数のラベルを付与すること
- 物体検出
  - 物体が存在する領域をROIで切出す
- セマンティックセグメンテーション
  - 境界
- インスタンスセグメンテーション
  - 同じクラスの物体が隣接していて置かれている場合でも、１つずつ境界を切り分けて認識
  - 興味がある分野はここ

** クラス認識の手順

- 画像特徴抽出
  - 極小特徴のサンプリング
    - 疎なサンプリングと密なサンプリングがある
    - 要するにキーポイント（特徴点）の抽出
  - 局所特徴の記述
    - 特徴点周囲の画像小領域（パッチ）の特徴を記述する
      - 要するにSIFTとか
  - 統計的特徴抽出
    - 生なままだと使えないので、確率統計的に基づいた特徴を得る
      - 主成分分析やフィッシャー線形判別分析
  - コーディング
    - ある決まった次元数の特徴ベクトルに変換する
      - ベクトル量子化、がなんたるかがわかっていない
  - プーリング
    - 特徴ベクトル郡を1本のベクトルにまとめること
      - よくわかっていないけど、例えばsiftを使った物体検出はプーリングしている？
      - 平均プーリングがあるとのことだが、うまくいく気がしない
- 分類
  - クラスに割り振る処理

シャローラーニングとディープラーニングがある

** 物体検出
- 物体領域候補の抽出
  - スライディングウィンドウが紹介されているけど、これは古いという理解。そもそもヒートマップを使うのだろうか。
- 物体領域候補の物体認識
  - クラス分類を行う
- 検出領域の絞込
  - 要するに極大を選別する

** インスタンス認識
- 同じ物体でも、位置、向き、傾き、大きさ、明るさなどで、見え方が全然違うことに注意が必要
- 結局ハッシングが肝になるという話だと思う
- 画像を登録するわけだけど
  - 特徴点検出と記述、画像特徴の計算とインデックス化、画像のルックアップテーブルへの登録
    - 量子化もしくはバイナリ化
- 検索するときは、ハッシングでアクセスしたあとに、正確性を帰すために、局所特徴マッチングを行う


* 局所特徴
- 局所特徴(local feature)と大域特徴(global feature)

** 局所特徴とは  
- 再現性
  - 違う画像でも、同じ場所にキーポイントがでる
- 頑健性
  - ノイズに強い
- 不変性
  - 回転、並進、アフィンや、スケールに強い
- 検出と記述
  - 見つけたあとに、SIFT特徴量を計算して付与するのが記述

** 検出器
- エッジ検出、コーナー検出、ブロブ検出

** 空間フィルタリング
- カーネル（フィルタの内容）orマスク
- 相関(correlation)の計算
- 畳み込みが相関のかかり方が逆なだけという説明に一瞬えっと思ったが確かにそうなる
- 畳み込み演算では、交換則や結合法則が成立する
  - F * G = G * F
  - F * (G * I) = (F * G) * I

- 平均化フィルタ、ガウシアンフィルタ（σをスケールとよぶことも）、バイラテラルフィルタ（非線形）

** 基本的な検出器
*** エッジ検出器
- 一次微分によるエッジ検出が主流だろう
  - プリューウィットフィルタ
  - ソーベルフィルタ
  - キャニーエッジフィルタ
- 二次微分
  - ラプラシアン
    - ラプラシアンではないが、$I_{xx}(x,y) = I(x+1, y) + I(x-1,y) - 2I(x,y)$
  - LoGフィルタ(ラプラシアン・ガウシアンフィルタ)
    - 原理的に、エッジとコーナの両方が見つかりそうな気がする
*** コーナー検出器
- ヘシアンコーナ検出器
  - 曲率(curvature)を求める
  - ガウス曲率(式2.28)
    - $K=\frac{det(H)}{(1 + I_x^2 + I_y^2)^2}$
    - ヘッセ行列
      - $I_{xx},I_{xy}, I_{xy}, I_{yy}$ からなる行列
      - $I_{xy}$は（左上＋右下）-(右上+左下)なので正負がわからないが、必ず２乗されて正になる
- モラベックコーナー
  - 実際に動かして相関が悪い場所
- ハリスコーナー
  - 相関（差）を最大にする微小並進(u, v)を求める $(u v)^T M (u v)$ に対して、Mの固有値が両方大きければコーナー、一つが大きければエッジ、両方小さければ平坦
  - だけどそれはさすがに重い
  - $C = det(M) - k(tr(M))^2$ でいい感じに判定できる、というのがハリスコーナー
  - 上式のような、コーナー度合いを判定するのがコーナネス
- SUNSAMとセグメントテストは読み飛ばし
- FASTコーナ検出器
  - 決定木の学習方法が書いてある
  - 画素iを選択したときの情報利得が最大となる画素iを選択する
    - つまりできるサブグープが最もいい感じに区分けされる画素iを選ぶことを繰り返す
    - 画素には限りがあるし、全く同じ特徴でもコーナーと非コーナーが異なるケースもあるだろうので、分類しきれるとは限らない。
      - 最終的には多い方にする
  - 決定木のエントロピーを基に、分け方を決める流れは覚えておいた方が良いだろう

*** ブロブ検出器
- LoGやDoG
- 同等になるとのことなので、おそらく大抵の場合、DoGが使われる
  - DoGは画像側を小さくすることで、階層的に拘束に処理を行えうる

**** ヘシアンの行列式を用いた検出器
   - ボックスフィルタという考え方がある。
   - ボックスフィルタは積分画像で高速化可能。
   - $D_{xy}$ を見るに、$I_{xy}$ も(左上＋右下)-(右上+左下)。

**** 正確なキーポイント

   - DoG(Diff of Gaussian)には、コーナーも含まれてしまうので、ハリスコーナーと同じ考え方でコーナーは削除できる
   - 式(2.62)はなんとなくはわかるが、しっかりとはわかっていない。
     まあ、実装するわけではないが、ステレオマッチングとサブピクセルの計算と似ていると思えば良いだろう。

** 回転とアフィンに頑健な検出器
   - スケール不変性が大事
     - DoGを使っていれば、スケール不変性はσが吸収してくれそうだ
*** 回転に対する不変性
   - 一般的に回転不変性の確保は、領域内の支配的な方向を発見し、この領域内の画像を支配的な方向に正規化する
     - 支配的な方向の設定次第では、マッチングにも使えるなー
   - 輝度勾配を使った支配方向の決定
     - 輝度勾配は一次でエッジと一緒
     - 方向ヒストグラムを使って支配的な方向を決定
     - 輝度勾配の方向を高速に求めるために、ボックスフィルタを使う
       - ハールウェーブレット(haar wavelet)
   - パッチ（局所的な画像）のモーメントでも良い
*** アフィン不変性
    - 円形領域を抽出
    - ２次モーメントの行列を求め、固有値を計算
    - 楕円が円になるように特徴点周りの局所領域を変形
      - 間をとるのかな？
    - それとは別に、MSERがある
** 記述子
- description, descriptor, local descriptorという単語

*** 局所バイナリパターン(LBP)
- マッチングをビット演算でできるというのが良さそうだ

*** 局所輝度勾配
- 局所輝度勾配は、エッジを検出する効果があるので形の情報を表現しているといえる

*** SIFT記述子
- 各画素を強度と角度で表現される輝度勾配画像に変換する
- その分布を $x, y, \theta$ でヒストグラムで表現したのがSIFT特徴
  - ポイントは、そのまま画素が使われるわけではなく、例えば16x16の画素を4x4にブロック化する
    - 各所でガウシアン重みの工夫が存在する
- SIFTは結構単純
  - PCA-SIFTとかある

*** HOG
- HOGは飛ばす

*** SURF
- SIFTを改良して高速化
  
1. まず、ボックスフィルタを使ったヘシアンの行列式を使って、キーポイントとスケールσを取得
1. キーポイントの周りに、20σx20σの局所領域をとり、4x4のセルに分割
1. 各セルの5x5のグリッド上の点において、ハールウェーブレット応答を求める
  - 2σ×2σのボックスフィルタをつかう
1. 求めた$d_x, d_y$ はガウシアンフィルタを用いて重み付け
   - 遠くのセルのdx, dyが小さくなりがちだけど、まあ、それはそういうものと言うことで良いのかな
1. 一つのセルの特徴量は以下の通り
   - $\sum{d_x}, \sum{d_y}, \sum|{d_x}|, \sum|{d_y}|$
1. 統合してL2正規化したのが、すると特徴ベクトル
   - つまり、16x4の64次元の特徴であることに注意

*** バイナリ局所記述子  
- 
